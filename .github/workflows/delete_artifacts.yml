# This is a basic workflow that is manually triggered

name: Delete all artifacts

on:
  workflow_dispatch:
    inputs:
      confirm:
        description: "Type 'YES' to confirm deletion of all artifacts"
        required: true
        type: string

permissions:
  actions: write
  contents: read

jobs:
  delete-artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: Verify confirmation
        run: |
          if [ "${{ github.event.inputs.confirm }}" != "YES" ]; then
            echo "Confirmation failed. You must type 'YES' to proceed."
            exit 1
          fi

      - name: Delete all artifacts
        uses: actions/github-script@v7
        with:
          script: |
            const artifacts = await github.rest.actions.listArtifactsForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              per_page: 100
            });

            if (artifacts.data.artifacts.length === 0) {
              console.log("No artifacts found.");
            } else {
              for (const artifact of artifacts.data.artifacts) {
                console.log(`Deleting artifact: ${artifact.name} (${artifact.id})`);
                await github.rest.actions.deleteArtifact({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  artifact_id: artifact.id
                });
              }
              console.log("All artifacts deleted.");
            }

